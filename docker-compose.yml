version: '3.8'

services:
  # 1. Servicio Web/PHP (OpenLiteSpeed + PHP)
  openlitespeed:
    # Usaremos una imagen de OpenLiteSpeed con PHP integrado (de LiteSpeed Tech)
    image: litespeedtech/openlitespeed:latest
    container_name: openlitespeed_web
    restart: always
    ports:
      # Puerto para el tráfico HTTP (web)
      - "80:80"
      # Puerto para el tráfico HTTPS (web)
      - "443:443"
      # Puerto del Panel de Administración de OpenLiteSpeed (IMPORTANTE: Cambiar la contraseña por defecto)
      - "7080:7080"
    volumes:
      # Monta los archivos de configuración de OLS (si los tienes)
      - ./conf:/usr/local/lsws/conf
      # Monta la carpeta de tus sitios web
      - ./html:/var/www/vhosts/localhost/html
      # Archivos de registro
      - ./logs:/usr/local/lsws/logs
    environment:
      # Establece la versión de PHP (OLS generalmente usa lsphp)
      # Puedes ajustar esto según la imagen que uses
      PHP_VER: 74 # O 80, 81, etc.
    depends_on:
      - mariadb

  # 2. Servicio de Base de Datos (MariaDB)
  mariadb:
    image: mariadb:latest
    container_name: mariadb_db
    restart: always
    # Expone el puerto, aunque solo lo usaremos internamente con phpMyAdmin
    ports:
      - "3306:3306" 
    volumes:
      # Persistencia de los datos de la base de datos
      - ./data/mariadb:/var/lib/mysql
    environment:
      # --- VARIABLES REQUERIDAS ---
      # ¡IMPORTANTE! Cambia esta contraseña por una segura
      MARIADB_ROOT_PASSWORD: my_strong_root_password
      MARIADB_DATABASE: my_database
      MARIADB_USER: my_db_user
      MARIADB_PASSWORD: my_db_password

  # 3. Herramienta de Gestión de Base de Datos (phpMyAdmin)
  phpmyadmin:
    image: phpmyadmin/phpmyadmin:latest
    container_name: phpmyadmin_tool
    restart: always
    ports:
      # Acceso web a phpMyAdmin
      - "8080:80"
    environment:
      # Host de la base de datos (nombre del servicio en docker-compose)
      PMA_HOST: mariadb
      # Puerto de la base de datos
      PMA_PORT: 3306
      # Evita la advertencia del check de setup
      PMA_ARBITRARY: 1
    depends_on:
      - mariadb

# Define los volúmenes para persistir datos fuera de los contenedores
volumes:
  conf:
  html:
  logs:
  data:
